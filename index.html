<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Twitch Checkpoint Bot Queue Helper</title>
<style>
  body {
    background-image: url(https://drive.google.com/thumbnail?authuser=0&sz=w1500&id=1ZPVU1KYPWhEBInb2f_wiTxChUlaDbjBc);
    background-size: cover;
    background-repeat: no-repeat;
    color: white;
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 20px;
  }
  h1 {
    text-align: center;
    margin-bottom: 15px;
  }
  .bungie-name {
    text-align: center;
    margin-bottom: 20px;
  }
  input#bungiename {
    padding: 5px;
    font-size: 1rem;
    border-radius: 6px;
    border: none;
    width: 220px;
  }
  .flex-parent {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-bottom: 15px;
    flex-wrap: wrap;
  }
  button {
    border-radius: 12px;
    cursor: pointer;
    padding: 10px 15px;
    font-weight: bold;
    font-size: 1rem;
    border: none;
    color: white;
    user-select: none;
  }
  button.activitytype {
    background-color: #b83232; /* red-ish */
    flex: 1 1 120px;
    max-width: 150px;
  }
  button.activity {
    background-color: #111;
    flex: 1 1 120px;
    max-width: 250px;
    margin-bottom: 6px;
  }
  button.encounter {
    background-color: #111;
    flex: 1 1 120px;
    max-width: 250px;
    margin-bottom: 6px;
    display: none;
  }
  button.difficulty {
    background-color: purple;
    flex: 1 1 120px;
    max-width: 150px;
  }
  button:disabled {
    opacity: 0.4;
    cursor: not-allowed;
  }
  .highlighted {
    background-color: #4CAF50 !important; /* bright green */
    box-shadow: 0 0 8px 2px #88ff88;
  }
  .container {
    display: flex;
    gap: 30px;
    flex-wrap: wrap;
    justify-content: center;
    margin-bottom: 20px;
  }
  .column {
    min-width: 280px;
    max-width: 320px;
  }
  .typeText {
    text-align: center;
    margin-bottom: 10px;
    font-weight: bold;
    font-size: 1.1rem;
  }
  .queueOptions {
    text-align: center;
    font-size: 1.1rem;
    margin-top: 10px;
  }
  #queueString {
    background: rgba(0,0,0,0.3);
    padding: 10px;
    border-radius: 10px;
    display: inline-block;
    min-width: 220px;
    user-select: all;
  }
  button.copy-btn {
    margin-top: 10px;
    background-color: #333;
  }
  @media (max-width: 700px) {
    .container {
      flex-direction: column;
      align-items: center;
    }
  }
</style>
</head>
<body>
  <h1>Twitch Checkpoint Bot Queue Helper</h1>
  <p class="bungie-name">
    Bungie Name: 
    <input
      type="text"
      id="bungiename"
      placeholder="bungiename#0000"
      oninput="validateBungieName()"
      autocomplete="off"
      spellcheck="false"
    />
  </p>

  <div class="flex-parent" id="activityTypeButtons">
    <!-- Activity Type buttons injected here -->
  </div>

  <div class="container">
    <div class="column">
      <p class="typeText" id="activityLabel">Activity:</p>
      <div id="activityButtons" class="flex-parent" style="flex-direction: column;">
        <!-- Activity buttons injected here -->
      </div>
    </div>
    <div class="column">
      <p class="typeText" id="encounterLabel">Encounter:</p>
      <div id="encounterButtons" class="flex-parent" style="flex-direction: column;">
        <!-- Encounter buttons injected here -->
      </div>
    </div>
  </div>

  <div class="flex-parent" id="difficultyButtons" style="justify-content:center; margin-bottom:20px;">
    <button id="difficultyNormalbutton" class="difficulty" type="button" onclick="selectDifficulty(false)">Normal</button>
    <button id="difficultyMasterbutton" class="difficulty" type="button" onclick="selectDifficulty(true)">Master</button>
  </div>

  <div class="queueOptions">
    <p id="queueString">!queue</p>
    <button class="copy-btn" type="button" onclick="copyQueueString()">Copy to Clipboard</button>
  </div>

<script>
  // Data: Activities sorted by age (oldest to newest)
  const activityData = {
    raids: {
      displayName: "Raids",
      activities: {
        "Vault of Glass": {
          code: "vog",
          encounters: [
            "1: Confluxes / Chest 1 & 2",
            "2: Oracles",
            "3: Templar",
            "Post-Templar",
            "4: Gatekeeper / Chest 4",
            "5: Atheon",
          ],
          difficultyEnabled: true,
        },
        "Crota's End": {
          code: "ce",
          encounters: [
            "1: Abyss",
            "2: Bridge",
            "Chest 2",
            "3: Ir Yut / Deathsinger",
            "4: Crota",
          ],
          difficultyEnabled: true,
        },
        "King's Fall": {
          code: "kf",
          encounters: [
            "1: Totems",
            "2: Warpriest",
            "Maze / Chest 3",
            "3: Golgoroth",
            "Wall / Chest 4",
            "4: Daughters / Deathsingers",
            "5: Oryx",
          ],
          difficultyEnabled: true,
        },
        "Last Wish": {
          code: "lw",
          encounters: [
            "1: Kali",
            "2: Shuro-Chi / Chest 1",
            "3: Morgeth / Chest 2",
            "Chest 2",
            "4: Vault",
            "5: Riven",
          ],
          difficultyEnabled: false,
        },
        "Garden of Salvation": {
          code: "gos",
          encounters: [
            "1: Embrace",
            "Chest 1",
            "2: Undergrowth",
            "3: Consecrated Mind",
            "Chest 2",
            "4: Sanctified Mind",
          ],
          difficultyEnabled: false,
        },
        "Deep Stone Crypt": {
          code: "dsc",
          encounters: [
            "1: Security",
            "2: Atraks-1",
            "Chest 2",
            "3: Descent",
            "4: Taniks",
          ],
          difficultyEnabled: false,
        },
        "Vow of the Disciple": {
          code: "votd",
          encounters: [
            "Chest 1",
            "1: Acquisition",
            "2: Caretaker",
            "Chest2",
            "3: Exhibition / The Upended",
            "4: Rhulk",
          ],
          difficultyEnabled: true,
        },
        "Root of Nightmares": {
          code: "ron",
          encounters: [
            "1: Cataclysm",
            "Chest 1",
            "2: Scission",
            "Chest 2",
            "3: Macrocosm / Explicator",
            "4: Nezarec",
          ],
          difficultyEnabled: true,
        },
        "Salvation's Edge": {
          code: "se",
          encounters: [
            "1: Substratum",
            "2: Dissipation",
            "Chest 1",
            "3: Repository",
            "4: Verity",
            "Chest 2",
            "5: The Witness",
          ],
          difficultyEnabled: true,
        },
      },
    },

    dungeons: {
      displayName: "Dungeons",
      activities: {
        "Shattered Throne": {
          code: "st",
          encounters: ["1", "2", "3: Simmumah / Final Boss"],
          difficultyEnabled: false,
        },
        "Pit of Heresy": {
          code: "poh",
          encounters: ["1", "2", "3: Zulmak / Final Boss"],
          difficultyEnabled: false,
        },
        "Prophecy": {
          code: "prophecy",
          encounters: [
            "1: Phalanx / First Boss",
            "Chest 1",
            "2: Cube",
            "Chest 2",
            "3: Zulmak / Final Boss",
          ],
          difficultyEnabled: false,
        },
        "Grasp of Avarice": {
          code: "goa",
          encounters: [
            "Chest 1",
            "1: Ogre / First Boss",
            "Chest 2",
            "2: Shield",
            "3: Avarokk / Final Boss",
          ],
          difficultyEnabled: true,
        },
        "Duality": {
          code: "duality",
          encounters: [
            "1: Gahlran / First Boss",
            "Chest 1",
            "2: Vault",
            "Chest 2",
            "3: Caiatl / Final Boss",
          ],
          difficultyEnabled: true,
        },
        "Spire of the Watcher": {
          code: "sotw",
          encounters: [
            "Chest 1",
            "1: Ascent",
            "2: Akelous / First Boss",
            "Chest 2",
            "3: Persys / Final Boss",
          ],
          difficultyEnabled: true,
        },
        "Ghosts of the Deep": {
          code: "gotd",
          encounters: [
            "1: Ritual",
            "Chest 1",
            "2: Ecthar / First Boss",
            "3: Simmumah / Final Boss / Chest 2",
          ],
          difficultyEnabled: true,
        },
        "Warlord's Ruin": {
          code: "wr",
          encounters: [
            "1: Rathil / First Boss",
            "2: Tempest / Second Boss",
            "Chest",
            "3: Hefnd / Final Boss",
          ],
          difficultyEnabled: true,
        },
        "Sundered Doctrine": {
          code: "sd",
          encounters: [
            "1: Flooded Inspection",
            "Chest1",
            "2: Zoetic Lockset",
            "Chest 2",
            "3: Kerrev, The Erased",
          ],
          difficultyEnabled: true,
        },
        "Vesper's Host": {
          code: "vh",
          encounters: ["1", "Chest1", "2", "Chest2", "3: Final Boss"],
          difficultyEnabled: true,
        },
      },
    },

    other: {
      displayName: "Stories/Other",
      activities: {
        Shared Wisdom: {
          code: "sw",
          encounters: ["1: The Helm"],
          difficultyEnabled: false,
        },
        "The Final Shape": {
          code: "fs",
          encounters: [
            "1: Transmigration",
            "2: Temptation",
            "3: Exegesis",
            "4: Requiem",
            "5: Ascent",
            "6: Dissent",
            "7: Iconoclasm",
          ],
          difficultyEnabled: true,
        },
        Lightfall: {
          code: "lf",
          encounters: [
            "1: First Contact",
            "2: Under Siege",
            "3: Downfall",
            "4: Breakneck",
            "5: On The Verge",
            "6: No Time Left",
            "7: Headlong",
            "8: Desperate Measures",
          ],
          difficultyEnabled: true,
        },
      },
    },
  };

  // State
  let selectedActivityType = null;
  let selectedActivity = null;
  let selectedEncounter = null;
  let isMasterDifficulty = false;

  // Elements
  const activityTypeContainer = document.getElementById("activityTypeButtons");
  const activityContainer = document.getElementById("activityButtons");
  const encounterContainer = document.getElementById("encounterButtons");
  const queueStringEl = document.getElementById("queueString");
  const bungieNameInput = document.getElementById("bungiename");

  // Create Activity Type Buttons
  function createActivityTypeButtons() {
    for (const typeKey in activityData) {
      const btn = document.createElement("button");
      btn.textContent = activityData[typeKey].displayName;
      btn.classList.add("activitytype");
      btn.id = `activitytype-${typeKey}`;
      btn.type = "button";
      btn.onclick = () => selectActivityType(typeKey);
      activityTypeContainer.appendChild(btn);
    }
  }

  // Select Activity Type
  function selectActivityType(typeKey) {
    if (selectedActivityType === typeKey) return; // No change

    selectedActivityType = typeKey;
    selectedActivity = null;
    selectedEncounter = null;
    isMasterDifficulty = false;
    updateDifficultyButtons(false);

    // Highlight selected activity type button
    highlightButtons(activityTypeContainer, `activitytype-${typeKey}`);

    // Render activities
    renderActivities(typeKey);

    // Clear encounters container
    encounterContainer.innerHTML = "";

    updateQueueString();
  }

  // Render Activities for chosen activity type
  function renderActivities(typeKey) {
    activityContainer.innerHTML = "";
    const activities = activityData[typeKey].activities;

    for (const activityName in activities) {
      const btn = document.createElement("button");
      btn.textContent = activityName;
      btn.classList.add("activity");
      btn.id = `activity-${activityName.replace(/\s+/g, "-").toLowerCase()}`;
      btn.type = "button";
      btn.onclick = () => selectActivity(activityName);
      activityContainer.appendChild(btn);
    }
  }

  // Select Activity
  function selectActivity(activityName) {
    if (selectedActivity === activityName) return; // No change

    selectedActivity = activityName;
    selectedEncounter = null;

    // Highlight selected activity button
    highlightButtons(activityContainer, `activity-${activityName.replace(/\s+/g, "-").toLowerCase()}`);

    // Render encounters for this activity
    renderEncounters(selectedActivityType, activityName);

    // Reset difficulty to Normal on activity change
    isMasterDifficulty = false;
    updateDifficultyButtons(false);

    updateQueueString();
  }

  // Render Encounters for chosen activity
  function renderEncounters(typeKey, activityName) {
    encounterContainer.innerHTML = "";
    const activity = activityData[typeKey].activities[activityName];
    if (!activity) return;

    activity.encounters.forEach((encounter, idx) => {
      const btn = document.createElement("button");
      btn.textContent = encounter;
      btn.classList.add("encounter");
      btn.type = "button";
      btn.id = `encounter-${idx}`;

      btn.onclick = () => selectEncounter(idx);
      encounterContainer.appendChild(btn);
      btn.style.display = "block";
    });

    // Auto-select first encounter
    if (activity.encounters.length > 0) {
      selectEncounter(0);
    }
  }

  // Select Encounter
  function selectEncounter(encounterIdx) {
    selectedEncounter = encounterIdx;
    // Highlight selected encounter button
    highlightButtons(encounterContainer, `encounter-${encounterIdx}`);
    updateQueueString();
  }

  // Highlight one button among siblings
  function highlightButtons(container, selectedId) {
    [...container.children].forEach((btn) => {
      btn.classList.toggle("highlighted", btn.id === selectedId);
    });
  }

  // Difficulty Buttons handling
  function selectDifficulty(masterSelected) {
    isMasterDifficulty = masterSelected;
    updateDifficultyButtons(masterSelected);
    updateQueueString();
  }

  // Update difficulty buttons' styles and disabled state
  function updateDifficultyButtons(masterSelected) {
    const normalBtn = document.getElementById("difficultyNormalbutton");
    const masterBtn = document.getElementById("difficultyMasterbutton");

    // Highlight selection
    normalBtn.classList.toggle("highlighted", !masterSelected);
    masterBtn.classList.toggle("highlighted", masterSelected);

    // Disable master button if difficulty not allowed for activity
    if (selectedActivityType && selectedActivity) {
      const diffEnabled = activityData[selectedActivityType].activities[selectedActivity].difficultyEnabled;
      masterBtn.disabled = !diffEnabled;
      if (!diffEnabled) {
        // If master is disabled and was selected, reset to normal
        if (isMasterDifficulty) {
          isMasterDifficulty = false;
          normalBtn.classList.add("highlighted");
          masterBtn.classList.remove("highlighted");
        }
      }
    } else {
      masterBtn.disabled = true;
    }
  }

  // Validate Bungie name format
  function validateBungieName() {
    const val = bungieNameInput.value.trim();
    const regex = /^.{3,32}#\d{4}$/; // Basic check: 3-32 chars + # + 4 digits
    if (!regex.test(val)) {
      bungieNameInput.style.borderColor = "red";
    } else {
      bungieNameInput.style.borderColor = "";
    }
    updateQueueString();
  }

  // Generate the queue string based on current selections
  function updateQueueString() {
    if (!selectedActivityType || !selectedActivity || selectedEncounter === null) {
      queueStringEl.textContent = "!queue";
      return;
    }
    const bungieName = bungieNameInput.value.trim();
    if (!bungieName) {
      queueStringEl.textContent = "!queue";
      return;
    }

    const actData = activityData[selectedActivityType].activities[selectedActivity];
    const difficultyCode = isMasterDifficulty ? "m" : "n";
    const encounterCode = selectedEncounter + 1; // 1-based index

    // Format: !queue <bungieName> <activityCode> <encounterNumber> <difficulty>
    const queueString = `!queue ${bungieName} ${actData.code} ${encounterCode} ${difficultyCode}`;
    queueStringEl.textContent = queueString;
  }

  // Copy queue string to clipboard
  async function copyQueueString() {
    try {
      await navigator.clipboard.writeText(queueStringEl.textContent);
      alert("Copied to clipboard!");
    } catch (err) {
      alert("Failed to copy!");
    }
  }

  // Initialize buttons on page load
  function init() {
    createActivityTypeButtons();

    // Select first activity type by default
    const firstType = Object.keys(activityData)[0];
    if (firstType) {
      selectActivityType(firstType);
    }

    // Select Normal difficulty by default
    selectDifficulty(false);
  }

  // Start the app
  init();
</script>
</body>
</html>
