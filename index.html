<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Helper tool for Twitch Checkpoint Bot queue commands. Quickly build and copy queue commands for Destiny 2 activities." />
  <meta name="theme-color" content="#1a1a2e" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>ðŸŽ®</text></svg>">
  <title>Twitch Checkpoint Bot Queue Helper</title>
  <!-- Inline styles for demo; consider moving to external file for production -->
<style>
  * {
    box-sizing: border-box;
  }

  body {
    color: white;
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    padding: 20px;
    min-height: 100vh;
  }

  .container {
    max-width: 1200px;
    margin: 0 auto;
  }

  h1 {
    text-align: center;
    margin-bottom: 30px;
    font-size: 2.5rem;
    background: linear-gradient(45deg, #4CAF50, #2196F3);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .bungie-name {
    text-align: center;
    margin-bottom: 30px;
  }

  .bungie-name label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #e0e0e0;
  }

  .input-group {
    position: relative;
    display: inline-block;
  }

  input#bungiename {
    padding: 12px 16px;
    font-size: 1rem;
    border-radius: 8px;
    border: 2px solid #555;
    width: 250px;
    background: rgba(255, 255, 255, 0.1);
    color: white;
    transition: border-color 0.3s, box-shadow 0.3s;
  }

  input#bungiename:focus {
    outline: 2px solid #2196F3;
    outline-offset: 2px;
    border-color: #4CAF50;
    box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.2);
  }

  /* Improve focus for all buttons for accessibility */
  button:focus {
    outline: 2px solid #2196F3;
    outline-offset: 2px;
    z-index: 2;
  }

  input#bungiename.valid {
    border-color: #4CAF50;
  }

  input#bungiename.invalid {
    border-color: #f44336;
  }

  .validation-message {
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    margin-top: 5px;
    font-size: 0.85rem;
    color: #f44336;
    opacity: 0;
    transition: opacity 0.3s;
  }

  .validation-message.show {
    opacity: 1;
  }

  .section {
    margin-bottom: 30px;
  }

  .section-title {
    text-align: center;
    font-size: 1.3rem;
    font-weight: 600;
    margin-bottom: 15px;
    color: #e0e0e0;
  }

  .flex-parent {
    display: flex;
    justify-content: center;
    gap: 12px;
    margin-bottom: 20px;
    flex-wrap: wrap;
  }

  button {
    border-radius: 8px;
    cursor: pointer;
    padding: 6px 12px;
    font-weight: 600;
    font-size: clamp(0.85rem, 2vw, 1rem);
    border: none;
    color: white;
    user-select: none;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
    min-width: 80px;
    line-height: 1.2;
  }

  button::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    transform: translate(-50%, -50%);
    transition: width 0.3s, height 0.3s;
  }

  button:hover::before {
    width: 200px;
    height: 200px;
  }

  button.activitytype {
    background: linear-gradient(135deg, #e74c3c, #c0392b);
    flex: 1 1 80px;
    max-width: 120px;
    box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
  }

  button.activitytype:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
  }

  button.activity, button.encounter {
    background: linear-gradient(135deg, #2c3e50, #34495e);
    flex: 1 1 80px;
    max-width: 120px;
    margin-bottom: 2px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    font-size: 0.92em;
    padding: 1px 8px;
    line-height: 1;
    min-width: 56px;
    min-height: 18px;
    height: 20px;
  }

  button.activity:hover, button.encounter:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
  }

  button.difficulty {
    background: linear-gradient(135deg, #8e44ad, #9b59b6);
    flex: 1 1 80px;
    max-width: 120px;
    box-shadow: 0 4px 15px rgba(142, 68, 173, 0.3);
  }

  button.difficulty:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(142, 68, 173, 0.4);
  }

  button:disabled {
    opacity: 0.4;
    cursor: not-allowed;
    transform: none !important;
  }

  button:disabled::before {
    display: none;
  }

  .highlighted {
    background: linear-gradient(135deg, #4CAF50, #45a049) !important;
    box-shadow: 0 0 20px rgba(76, 175, 80, 0.6) !important;
    transform: scale(1.05);
  }

  .content-grid {
    display: flex;
    flex-direction: row;
    gap: 40px;
    margin-bottom: 30px;
    justify-content: center;
    align-items: flex-start;
  }

  .column {
    min-width: 0;
    flex: 1 1 220px;
    max-width: 350px;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    justify-content: flex-start;
  }

  .column-content {
    display: flex;
    flex-direction: column;
    gap: 8px;
    align-items: flex-start;
    width: 100%;
  }

  .queue-section {
    text-align: center;
    margin-top: 40px;
  }

  .queue-output {
    background: rgba(0, 0, 0, 0.4);
    border: 2px solid #555;
    padding: 20px;
    border-radius: 12px;
    display: inline-block;
    min-width: 300px;
    margin-bottom: 15px;
    font-family: 'Courier New', monospace;
    font-size: 1.1rem;
    user-select: all;
    transition: border-color 0.3s;
  }

  .queue-output.ready {
    border-color: #4CAF50;
    box-shadow: 0 0 20px rgba(76, 175, 80, 0.3);
  }

  .copy-btn {
    background: linear-gradient(135deg, #34495e, #2c3e50);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
  }

  .copy-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
  }

  .copy-btn:active {
    transform: translateY(0);
  }

  .toast {
    position: fixed;
    top: 20px;
    right: 20px;
    background: #4CAF50;
    color: white;
    padding: 12px 24px;
    border-radius: 8px;
    font-weight: 600;
    opacity: 0;
    transform: translateX(100%);
    transition: all 0.3s ease;
    z-index: 1000;
  }

  .toast.show {
    opacity: 1;
    transform: translateX(0);
  }

  .loading {
    opacity: 0.7;
    pointer-events: none;
  }

  @media (max-width: 768px) {
    .content-grid {
      grid-template-columns: 1fr;
      gap: 20px;
    }
    h1 {
      font-size: 2rem;
    }
    .flex-parent {
      gap: 6px;
    }
    button {
      padding: 5px 10px;
      font-size: 0.85rem;
      min-width: 60px;
    }
    input#bungiename {
      width: 160px;
    }
  }

  @media (max-width: 480px) {
    .content-grid {
      grid-template-columns: 1fr;
    }
    .queue-output {
      min-width: 120px;
      font-size: 0.95rem;
    }
    button {
      padding: 4px 8px;
      font-size: 0.8rem;
      min-width: 48px;
    }
  }

  @media (max-width: 480px) {
    .content-grid {
      grid-template-columns: 1fr;
    }
    
    .queue-output {
      min-width: 250px;
      font-size: 1rem;
    }
  }
</style>
</head>
<body>
  <div class="container" role="main">
    <!-- Top controls: Bungie Name, Difficulty, and Queue Command -->
    <div class="top-controls" style="display: flex; flex-wrap: wrap; gap: 24px; align-items: flex-end; justify-content: center; margin-bottom: 32px;">
      <!-- Bungie Name Input -->
      <div class="bungie-name" style="margin-bottom: 0;">
        <label for="bungiename">Bungie Name:</label>
        <div class="input-group">
          <input
            type="text"
            id="bungiename"
            placeholder="bungiename#0000"
            value="fossagenie#9155"
            autocomplete="off"
            spellcheck="false"
            aria-label="Bungie Name"
            aria-describedby="validationMessage"
            required
          />
          <div class="validation-message" id="validationMessage" aria-live="polite">
            Please enter a valid Bungie name (3-32 characters + #0000)
          </div>
        </div>
      </div>
      <!-- Activity Type and Difficulty in a row -->
      <div class="section" style="margin-bottom: 0;">
        <div style="display: flex; align-items: flex-end; gap: 32px; flex-wrap: wrap; justify-content: center;">
          <div>
            <div class="section-title" style="margin-bottom: 8px;">Activity Type</div>
            <div class="flex-parent" id="activityTypeButtons" role="group" aria-label="Activity Type Selection" style="margin-bottom: 0;">
              <!-- Activity Type buttons injected here -->
            </div>
          </div>
          <div>
            <div class="section-title" style="margin-bottom: 8px;">Difficulty</div>
            <div class="flex-parent" id="difficultyButtons" role="group" aria-label="Difficulty Selection" style="margin-bottom: 0;">
              <button id="difficultyNormalbutton" class="difficulty" type="button" aria-pressed="true">Normal</button>
              <button id="difficultyMasterbutton" class="difficulty" type="button" aria-pressed="false">Master</button>
            </div>
          </div>
        </div>
      </div>
      <!-- Queue Command Section -->
      <div class="queue-section" style="margin-top: 0;">
        <div class="section-title" style="margin-bottom: 8px;">Queue Command</div>
        <div id="queueString" class="queue-output" tabindex="0" aria-live="polite" style="margin-bottom: 8px;">!queue</div>
        <button class="copy-btn" type="button" id="copyButton" aria-label="Copy queue command to clipboard">Copy to Clipboard</button>
      </div>
    </div>

    <div class="section">
      <div class="section-title">Activity</div>
      <div id="activityButtons" class="column-content" role="group" aria-label="Activity Selection">
        <!-- Activity buttons injected here -->
      </div>
    </div>
    <div class="section">
      <div class="section-title">Encounter</div>
      <div id="encounterButtons" class="column-content" role="group" aria-label="Encounter Selection">
        <!-- Encounter buttons injected here -->
      </div>
    </div>
    <!-- Removed duplicate Difficulty and Queue Command sections -->
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite">Copied to clipboard!</div>

<!-- Main application script. For production, consider moving to a separate JS file. -->
<script>
  // Enhanced activity data with better organization
  const activityData = {
    raids: {
      displayName: "Raids",
      activities: {
        "Vault of Glass": {
          code: "vog",
          encounters: [
            "1: Confluxes / Chest 1 & 2",
            "2: Oracles",
            "3: Templar",
            "Post-Templar",
            "4: Gatekeeper / Chest 4",
            "5: Atheon",
          ],
          difficultyEnabled: true,
        },
        "Crota's End": {
          code: "ce",
          encounters: [
            "1: Abyss",
            "2: Bridge",
            "Chest 2",
            "3: Ir Yut / Deathsinger",
            "4: Crota",
          ],
          difficultyEnabled: true,
        },
        "King's Fall": {
          code: "kf",
          encounters: [
            "1: Totems",
            "2: Warpriest",
            "Maze / Chest 3",
            "3: Golgoroth",
            "Wall / Chest 4",
            "4: Daughters / Deathsingers",
            "5: Oryx",
          ],
          difficultyEnabled: true,
        },
        "Last Wish": {
          code: "lw",
          encounters: [
            "1: Kali",
            "2: Shuro-Chi / Chest 1",
            "3: Morgeth / Chest 2",
            "Chest 2",
            "4: Vault",
            "5: Riven",
          ],
          difficultyEnabled: false,
        },
        "Garden of Salvation": {
          code: "gos",
          encounters: [
            "1: Embrace",
            "Chest 1",
            "2: Undergrowth",
            "3: Consecrated Mind",
            "Chest 2",
            "4: Sanctified Mind",
          ],
          difficultyEnabled: false,
        },
        "Deep Stone Crypt": {
          code: "dsc",
          encounters: [
            "1: Security",
            "2: Atraks-1",
            "Chest 2",
            "3: Descent",
            "4: Taniks",
          ],
          difficultyEnabled: false,
        },
        "Vow of the Disciple": {
          code: "votd",
          encounters: [
            "Chest 1",
            "1: Acquisition",
            "2: Caretaker",
            "Chest2",
            "3: Exhibition / The Upended",
            "4: Rhulk",
          ],
          difficultyEnabled: true,
        },
        "Root of Nightmares": {
          code: "ron",
          encounters: [
            "1: Cataclysm",
            "Chest 1",
            "2: Scission",
            "Chest 2",
            "3: Macrocosm / Explicator",
            "4: Nezarec",
          ],
          difficultyEnabled: true,
        },
        "Salvation's Edge": {
          code: "se",
          encounters: [
            "1: Substratum",
            "2: Dissipation",
            "Chest 1",
            "3: Repository",
            "4: Verity",
            "Chest 2",
            "5: The Witness",
          ],
          difficultyEnabled: true,
        },
      },
    },

    dungeons: {
      displayName: "Dungeons",
      activities: {
        "Shattered Throne": {
          code: "st",
          encounters: ["1", "2", "3: Simmumah / Final Boss"],
          difficultyEnabled: false,
        },
        "Pit of Heresy": {
          code: "poh",
          encounters: ["1", "2", "3: Zulmak / Final Boss"],
          difficultyEnabled: false,
        },
        "Prophecy": {
          code: "prophecy",
          encounters: [
            "1: Phalanx / First Boss",
            "Chest 1",
            "2: Cube",
            "Chest 2",
            "3: Zulmak / Final Boss",
          ],
          difficultyEnabled: false,
        },
        "Grasp of Avarice": {
          code: "goa",
          encounters: [
            "Chest 1",
            "1: Ogre / First Boss",
            "Chest 2",
            "2: Shield",
            "3: Avarokk / Final Boss",
          ],
          difficultyEnabled: true,
        },
        "Duality": {
          code: "duality",
          encounters: [
            "1: Gahlran / First Boss",
            "Chest 1",
            "2: Vault",
            "Chest 2",
            "3: Caiatl / Final Boss",
          ],
          difficultyEnabled: true,
        },
        "Spire of the Watcher": {
          code: "sotw",
          encounters: [
            "Chest 1",
            "1: Ascent",
            "2: Akelous / First Boss",
            "Chest 2",
            "3: Persys / Final Boss",
          ],
          difficultyEnabled: true,
        },
        "Ghosts of the Deep": {
          code: "gotd",
          encounters: [
            "1: Ritual",
            "Chest 1",
            "2: Ecthar / First Boss",
            "3: Simmumah / Final Boss / Chest 2",
          ],
          difficultyEnabled: true,
        },
        "Warlord's Ruin": {
          code: "wr",
          encounters: [
            "1: Rathil / First Boss",
            "2: Tempest / Second Boss",
            "Chest",
            "3: Hefnd / Final Boss",
          ],
          difficultyEnabled: true,
        },
        "Sundered Doctrine": {
          code: "sd",
          encounters: [
            "1: Flooded Inspection",
            "Chest1",
            "2: Zoetic Lockset",
            "Chest 2",
            "3: Kerrev, The Erased",
          ],
          difficultyEnabled: true,
        },
        "Vesper's Host": {
          code: "vh",
          encounters: ["1", "Chest1", "2", "Chest2", "3: Final Boss"],
          difficultyEnabled: true,
        },
      },
    },

    other: {
      displayName: "Stories/Other",
      activities: {
        "Lightfall": {
          code: "lf",
          encounters: [
            "1: First Contact",
            "2: Under Siege",
            "3: Downfall",
            "4: Breakneck",
            "5: On The Verge",
            "6: No Time Left",
            "7: Headlong",
            "8: Desperate Measures",
          ],
          difficultyEnabled: true,
        },
        "Shared Wisdom": {
          code: "sw",
          encounters: ["1: The Helm"],
          difficultyEnabled: false,
        },
        "The Final Shape": {
          code: "fs",
          encounters: [
            "1: Transmigration",
            "2: Temptation",
            "3: Exegesis",
            "4: Requiem",
            "5: Ascent",
            "6: Dissent",
            "7: Iconoclasm",
          ],
          difficultyEnabled: true,
        },
      },
    },
  };

  // Application state
  class AppState {
    constructor() {
      this.selectedActivityType = null;
      this.selectedActivity = null;
      this.selectedEncounter = null;
      this.isMasterDifficulty = false;
      this.isValid = false;
    }

    reset() {
      this.selectedActivity = null;
      this.selectedEncounter = null;
      this.isMasterDifficulty = false;
    }

    isComplete() {
      return this.selectedActivityType && 
             this.selectedActivity && 
             this.selectedEncounter !== null && 
             this.isValid;
    }
  }

  // DOM elements cache
  const elements = {
    activityTypeContainer: document.getElementById("activityTypeButtons"),
    activityContainer: document.getElementById("activityButtons"),
    encounterContainer: document.getElementById("encounterButtons"),
    queueStringEl: document.getElementById("queueString"),
    bungieNameInput: document.getElementById("bungiename"),
    validationMessage: document.getElementById("validationMessage"),
    difficultyNormalBtn: document.getElementById("difficultyNormalbutton"),
    difficultyMasterBtn: document.getElementById("difficultyMasterbutton"),
    copyButton: document.getElementById("copyButton"),
    toast: document.getElementById("toast")
  };

  // Application state
  const state = new AppState();

  // Utility functions
  const utils = {
    debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    },

    generateId(prefix, text) {
      return `${prefix}-${text.replace(/\s+/g, "-").toLowerCase()}`;
    },

    showToast(message, duration = 3000) {
      elements.toast.textContent = message;
      elements.toast.classList.add('show');
      setTimeout(() => {
        elements.toast.classList.remove('show');
      }, duration);
    },

    validateBungieName(name) {
      const regex = /^.{3,32}#\d{4}$/;
      return regex.test(name.trim());
    }
  };

  // UI management
  const ui = {
    highlightButton(container, selectedId) {
      Array.from(container.children).forEach((btn) => {
        btn.classList.toggle("highlighted", btn.id === selectedId);
      });
    },

    createButton(text, classes, id, onClick) {
      const btn = document.createElement("button");
      btn.textContent = text;
      btn.className = classes;
      btn.id = id;
      btn.type = "button";
      btn.onclick = onClick;
      return btn;
    },

    updateValidation(isValid) {
      const input = elements.bungieNameInput;
      const message = elements.validationMessage;
      
      input.classList.toggle('valid', isValid);
      input.classList.toggle('invalid', !isValid);
      message.classList.toggle('show', !isValid);
    },

    updateQueueOutput() {
      const output = elements.queueStringEl;
      const queueStr = queueManager.generateQueueString();
      const isReady = state.isComplete();
      
      output.textContent = queueStr;
      output.classList.toggle('ready', isReady);
      elements.copyButton.disabled = !isReady;
    }
  };

  // Queue string management
  const queueManager = {
    generateQueueString() {
      if (!state.isComplete()) {
        return "!queue";
      }

      const bungieName = elements.bungieNameInput.value.trim();
      const activityInfo = activityData[state.selectedActivityType].activities[state.selectedActivity];
      const difficultyCode = state.isMasterDifficulty ? "m" : "n";
      const encounterNum = state.selectedEncounter + 1;

      return `!queue ${bungieName} ${activityInfo.code} ${encounterNum} ${difficultyCode}`;
    },

    async copyToClipboard() {
      const queueStr = elements.queueStringEl.textContent;
      
      try {
        await navigator.clipboard.writeText(queueStr);
        utils.showToast("Copied to clipboard!");
      } catch (error) {
        console.error('Failed to copy:', error);
        utils.showToast("Failed to copy to clipboard", 3000);
      }
    }
  };

  // Activity type management
  const activityTypeManager = {
    init() {
      this.createButtons();
      // Auto-select first activity type
      const firstType = Object.keys(activityData)[0];
      if (firstType) {
        this.select(firstType);
      }
    },

    createButtons() {
      elements.activityTypeContainer.innerHTML = "";
      
      Object.entries(activityData).forEach(([typeKey, typeData]) => {
        const btn = ui.createButton(
          typeData.displayName,
          "activitytype",
          utils.generateId("activitytype", typeKey),
          () => this.select(typeKey)
        );
        elements.activityTypeContainer.appendChild(btn);
      });
    },

    select(typeKey) {
      if (state.selectedActivityType === typeKey) return;

      state.selectedActivityType = typeKey;
      state.reset();

      ui.highlightButton(elements.activityTypeContainer, utils.generateId("activitytype", typeKey));
      
      activityManager.render(typeKey);
      encounterManager.clear();
      difficultyManager.update();
      ui.updateQueueOutput();
    }
  };

  // Activity management
  const activityManager = {
    render(typeKey) {
      elements.activityContainer.innerHTML = "";
      const activities = activityData[typeKey].activities;

      Object.keys(activities).forEach(activityName => {
        const btn = ui.createButton(
          activityName,
          "activity",
          utils.generateId("activity", activityName),
          () => this.select(activityName)
        );
        elements.activityContainer.appendChild(btn);
      });
    },

    select(activityName) {
      if (state.selectedActivity === activityName) return;

      state.selectedActivity = activityName;
      state.selectedEncounter = null;
      state.isMasterDifficulty = false;

      ui.highlightButton(elements.activityContainer, utils.generateId("activity", activityName));
      
      encounterManager.render(state.selectedActivityType, activityName);
      difficultyManager.update();
      ui.updateQueueOutput();
    }
  };

  // Encounter management
  const encounterManager = {
    render(typeKey, activityName) {
      elements.encounterContainer.innerHTML = "";
      const activity = activityData[typeKey].activities[activityName];
      if (!activity) return;

      activity.encounters.forEach((encounter, idx) => {
        const btn = ui.createButton(
          encounter,
          "encounter",
          utils.generateId("encounter", idx.toString()),
          () => this.select(idx)
        );
        elements.encounterContainer.appendChild(btn);
      });

      // Auto-select first encounter
      if (activity.encounters.length > 0) {
        this.select(0);
      }
    },

    select(encounterIdx) {
      if (state.selectedEncounter === encounterIdx) return;

      state.selectedEncounter = encounterIdx;
      ui.highlightButton(elements.encounterContainer, utils.generateId("encounter", encounterIdx.toString()));
      ui.updateQueueOutput();
      // Automatically copy queue command to clipboard and show notification
      if (state.isComplete()) {
        queueManager.copyToClipboard();
      }
    },

    clear() {
      elements.encounterContainer.innerHTML = "";
    }
  };

  // Difficulty management
  const difficultyManager = {
    init() {
      elements.difficultyNormalBtn.onclick = () => this.select(false);
      elements.difficultyMasterBtn.onclick = () => this.select(true);
      this.select(false); // Default to normal
    },

    select(masterSelected) {
      state.isMasterDifficulty = masterSelected;
      this.updateUI();
      ui.updateQueueOutput();
    },

    update() {
      this.updateUI();
    },

    updateUI() {
      const { difficultyNormalBtn, difficultyMasterBtn } = elements;
      
      difficultyNormalBtn.classList.toggle("highlighted", !state.isMasterDifficulty);
      difficultyMasterBtn.classList.toggle("highlighted", state.isMasterDifficulty);
      // Update ARIA pressed for accessibility
      difficultyNormalBtn.setAttribute('aria-pressed', (!state.isMasterDifficulty).toString());
      difficultyMasterBtn.setAttribute('aria-pressed', (state.isMasterDifficulty).toString());

      if (state.selectedActivityType && state.selectedActivity) {
        const difficultyAllowed = activityData[state.selectedActivityType].activities[state.selectedActivity].difficultyEnabled;
        difficultyMasterBtn.disabled = !difficultyAllowed;
        
        if (!difficultyAllowed && state.isMasterDifficulty) {
          state.isMasterDifficulty = false;
          difficultyNormalBtn.classList.add("highlighted");
          difficultyMasterBtn.classList.remove("highlighted");
        }
      } else {
        difficultyMasterBtn.disabled = true;
      }
    }
  };

  // Input validation
  const inputManager = {
    init() {
      const debouncedValidate = utils.debounce(() => {
        this.validate();
      }, 300);

      elements.bungieNameInput.addEventListener('input', debouncedValidate);
      elements.bungieNameInput.addEventListener('blur', () => this.validate());
      
      // Initial validation
      this.validate();
    },

    validate() {
      const name = elements.bungieNameInput.value.trim();
      state.isValid = utils.validateBungieName(name);
      
      ui.updateValidation(state.isValid);
      ui.updateQueueOutput();
    }
  };

  // Event handlers
  const eventHandlers = {
    init() {
      elements.copyButton.addEventListener('click', () => {
        queueManager.copyToClipboard();
      });

      // Keyboard shortcuts
      document.addEventListener('keydown', (e) => {
        if (e.ctrlKey && e.key === 'c' && state.isComplete()) {
          e.preventDefault();
          queueManager.copyToClipboard();
        }
      });
    }
  };

  // Application initialization
  function init() {
    try {
      activityTypeManager.init();
      difficultyManager.init();
      inputManager.init();
      eventHandlers.init();
      
      console.log('Twitch Checkpoint Bot Queue Helper initialized successfully');
    } catch (error) {
      console.error('Failed to initialize application:', error);
    }
  }

  // Start the application
  document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
